# PCB Layout and Design

## PCB基础

### 简介
PCB（Printed Circuit Board） 印制电路板，简称电路板。PCB是电子元器件的电气连接载体和支撑体，在20世纪50年代开始推广，是现代广泛采用的电路构建技术。

2.分类

![stdExp](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PCB_HOLe.png)
3.组成



TBD Q&A
PCB有好多类型层、如何知道设计一个PCB应该包含哪些层？需要哪些层？
PCB从表层到内层依次为：特殊工艺层、表面涂覆层、丝印层、线路层、基材 

层
-------------
1. signal layer 信号层
	该层是一个统称，包含Top layer顶层、Bottom layer底层、和N个Middle layer中间层
	，信号层用于布置PCB的导线，也是绘制PCB时经常操作的层

2. Internal plane layer 内部电源/接地层
	该层仅用于多层板（2层及以上），主要用于布置电源线和地线，常说的双层板、四层板、六层板，就是指信号层和内部电源/接地层的数目

3. Mechine layer 机械层
	一般用于设置电路板的外形尺寸、数据标记、对齐标记、装配说明等机械信息

4. Solder mask layer 阻焊层
	在焊盘以外的各部位涂覆一层涂料，用于阻止这些部位被上焊锡，组焊层用于在设计过程中匹配焊盘，是自动产生的

5. Keep out layer 禁止布线层
	该层绘制了一个封闭的区域作为布线有效区，在该区外 不可以布局和布线

6. Silkscreen layer 丝印层
	主要用于放置印制信息，如元件的轮廓、标准和各种注释字符等

7. Multi layer 多层
	电路板上焊盘和穿透式过孔要穿透整个电路板以与不同的导电层建立电气连接，因此系统设置了专门的抽象层-多层，焊盘和过孔都要设置在
	多层上，如果关闭此层，焊盘与过孔就无法显示出来

8. Drill layer 砖孔层
	提供电路板制造过程中的砖孔信息（如焊盘，过孔）

基本概念
--------------
1. 铺铜
	如果PCB的GND较多，如SGND AGND GND等等，就需要根据PCB版面的位置的不同 分别以最主要的地为基准参考来覆铜，即将地连接在一起

	好处是：
	减小地线阻抗，提高抗干扰能力
	降低压降，提高电源效率
	与地线相连还可以减小环路面积
	出于让PCB焊接时不变形的目的，PCB生产厂家会要求PCB设计者在PCB的空旷区域填充铜皮或者网格状的地线

2. 焊盘
	用于元件与PCB的电气连接

3. 过孔
	用于PCB各层之间的电气连接

![PCB孔](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PCB孔.png)

实体PCB
---------------
PCB的基板通常是由玻璃纤维构成。包覆住玻璃纤维层的则是铜，通常是透过一些特殊黏着剂以及热加工使其附在玻璃纤维板上
常说的2层4层8层都是指铜的层数,，彼此之间则有绝缘层，通过过孔建立电气连接

防焊剂会被涂在铜层之上，防焊剂的功用是为了要避免焊接时焊锡在焊点与走线之间到处流动，同时也可以防止铜层碰到其它导体造成短路。在PCB最上层有时则会再印上丝印，是用来描述脚位的名称、摆放位置、制造厂商与商标等等


# PCB画板

## 步骤
	画PCB有两种
	渠道：直接画PCB 或者 先画原理图再从原理图中导出到PCB。即原理图是可以忽略的，
	但原理图往往要提供给程序员和现场布线等人员使用，所以还是避免不了的，
	如果PCB生产比较急，可以采用前者方法，PCB发出制作之后再画原理图
	如果PCB生产不急，则可以采用后者的方法
	此外，先画原理图也能对PCB的整体构建有一个清晰的印象

	原理图到PCB的转换是依赖 网络表 实现的， 网络表是通过原理图设计工具自动产生的，是用于表达元器件之间的电气连接关系的文本文件

	1. 画原理图
		在画的过程中，如果库中没有使用的元件，需要自建元件，最好使用元件封装器，将其封装到库中
		如需分层的，见下文

	2. 标注原理图 
		一般在原理图中引入任何一个元件之后，随后做的事情之一就是命名该元件，如J？修改为J1、R?修改为R3、C？修改为C10等等，
		如果你有一批这样的事情没做、或害怕有遗漏（其实第三步会帮你找到）或不想一个一个弄，只想批量完成，那么
		就可以使用“标注原理图”工具，它将*自动*的 把带有类似“J？”的命名改为合理的命名。

	3. 执行电气规则检查 
		KICAD帮助找到原理图中遗漏的、不和规则的、错误的等等问题，找到之后可以右单机提示箭头，查看具体原因并修正

	4. 对应封装
		该步骤有两种方法：
			A：点击”分配PCB封装到原理图符号"，该方法属于一体式分配，建议当确保所使用的元件都有对应的封装库时使用
			B: 针对某个元器件右点击 选择“属性” 然后选择“编辑封装” 在弹出的对话框中点击“选择”（如果记得封装对应的文本，就直接输入文本，然后点击确定）
				找到对应的封装即可

			( 注：在KICAD中，也可以使用“编辑符号字段”功能，该功能不但能关联封装，还能直观修改元件名 )

		对于这两种方式，无论哪一种，如果发现没有找到对应合适的封装，就需要自己创建了

	4-2. 创建封装
		点击“封装编辑-创建/编辑封装”，编辑完成后再返回到第4步选择对应封装

		注意：如果没有对应封装，最好自己创建并关联。但如果这些不做也不会影响到网表的生成，到第6/7步时也可以在Layout的同时设计或引入封装（就像引入原理图中的元件一样）

	5. 生成网表

	6. 完善右下脚页面信息，该信息在打印和传递给其它工程人员时或者后期自己维护时非常有用
		位置在“文件->图框设置”

	7. (可选）生成BOM

	------------------ 至此，原理图部分就完成了 ---------------------------------------------------

	8. 打开PCBnew设计界面 并 读取原理图生成的网表(从原理图更新PCB 或 加载网表)

	9. 布线 Layout （ 连连看的过程开始了，这部分有电磁兼容性设计等等要求，还需要分层设计等，而不是直接就OK了）

	10. 执行调试规则检查（与原理图一样，可以通过软件检查PCB）

	11. 完善右下脚页面信息，该信息在打印和传递给其它工程人员时或者后期自己维护时非常有用

	12. 导出Gerber文件

	13. 生成钻孔文件 “文件->绘制”


## PCB Layout (KICAD 示例）


### 1. 设置电路板(可以在之前后之后从网络表或原理图导入PCBnew)

	点击菜单栏“文件->电路板设置”，弹出对话框 (或直接点击 电路板设置图标)

	点击“层”主类，设置PCB层数、PCB厚度、勾选非信号层（可选的或辅助的层）

	点击“文本与图形”子类，设置层和框的的布线宽度、文本宽度、

	点击“设计规则”主类，设置最小布线宽度、最小孔径等信息，以及是否允许盲孔和埋孔等等设置

	分别点击“网络类表”、“导线和过孔”、“阻焊/锡膏”子类，并设置相关信息

	详细解读TBD ... ...


	层之解读：
		前言1：
			我最开始接触到软件中层的概念是在PS中，PS的层是其灵魂，通过在不同的层上勾画和渲染以达到最终效果，
			PS的层是不可见的，但是顺序和结构很清晰，

			首先是建立图层、然后在图层上操作，想要切换到哪个图层就点击哪个，然后在该图层上操作

			但KICAD（其它软件也应该是这样）不一样，从原理图或网络表生成到PCBnew之后，默认所有封装器件都在顶层上，要通过切换或反转才更换层

			一个封装器件想要切换层，只需选中该器件并再选择层即可完成，同样的切换线路也是如此，而在PS中必须通过复制粘贴或者合并移动才能实现

			还有，PS中的所有层都是有意义的，是在“生产”中实际应用的，但在PCB中并不是这样，有些层并不是实际意义上的存在，更有些层其实不是层

		前言2：
			KICAD可以使用50个不同的层，其中1~32个铜层用于布线，

										   14个固定用途的技术层：
														a: 6对 成对儿层 （正/反面成对，共12层）：粘合剂层、焊膏层、丝印层、阻焊层、封装层、制造层
														b: 2个独立图层：边缘切割层、边距层

										   4个辅助层：
												注释、E.C.O.1、E.C.O,2、图纸

											32+(6*2+2)+4 = 50层

		描述：
			1. 铜层
				铜层是用于放置封住器件的和各封装器件连接通信的层，从顶层（0层）到底层（31层）一共可以有32层，只有顶层和底层可以防止封装器件
				F.Cu，称为顶层的铜层、B.Cu称为底层的铜层、一般双层板只有这两个铜层，如果是多层板则可能有In1.Cu（第二层）、In2.Cu（第三层）... ...

			2. 技术层 - 成对层
				
			3. 技术层 - 独立层
				边缘切割层 Edge.Cuts
					仅使用改层来绘制电路板的边框，所有的其它层，都在该层的框选之内的范围有效

				边距层 Margin
					描述电路板的边缘后退距离 TBD

			4. 辅助层
				这些层可以用于任何自定义用途：注释、E.C.O.1、E.C.O,2、图纸


### 2. 勾画PCB尺寸布局 
	
	这在AD系列软件中被称为“机械层”，在KICAD中被称为“边缘切割层”


1. 设定尺寸信息 

	PCB布线和原理图大不相同，原理图中没有体现元件的尺寸和封装信息，第一次体现这些信息是在关联封装时，

	因为尺寸和封装信息直接影响到PCB的生产。

	在进入PCBnew界面后，还需要修改的尺寸信息有[TBD]


	注意：进入PCBnew之后，第一眼看到的网格 往往并不是最小网格单元，（可能是软件或显示器的缘故）在某种放大程度下只显示当前程度的最小单元网格，
		  实际将页面放大之后是可以看到最小网格的，看到最小网格的标志就是，再放大也不出现网格了

2. 设定PCB层数



	导入原理图或读取网络表之后，首先看到的是一团由“飞线”连接的封装器件，
	我们可以通过移动和选装分装器件使得飞线交叉数量减少，飞线交叉数量最少是PCB布线的标准之一

## 术语
1. 网络标签(/网络标号)： 网络标签是原理图中，一个节点与另一个节点的电气连通。在画原理图时，往往并不能将所有的连线都直接连接起来，于是，对于那些
不能直接相连的节点，就需要使用网络标签。比如接口A-1是连接到器件B-3的，但原理图上不好布置这个连线，或处于模块化等原因要分开画，
于是可以在A-1接口放置标签XXYY，B-3接口也放置引出标签XXYY，这样在软件中就建立起了电气连通性
1）对软件来说，建立起了电气连通性，后续生成网络表时会有A-1和B-3的关联数据，以便在PCB中生成使用
2）对看图人员来说也有作用，搜索两个同名标签，就知道他们之间有了电气连通性

2. 全局标签（在PROTEL系列中称为PORT端口）：与网络标签具有同样的功能，并且还具备 方向 和 输入/输出 设定，

在MCU引脚中经常使用全局标签+网络标签，在其它芯片引脚中常使用网络标签

3. SMD
	Surface Mounted Devices， 表面贴装器 或 贴片封装

4. 元件/元件库
	元件是针对原理图而言的，原理图中使用到的“实体“图形就叫元件，比如电阻、电容、74HC574芯片等等...
	，元件库是元件的合集，可以直接调用，元件库一般都会由软件官方提供大部分常用的，如果没有，就需要自己编辑创建元件以丰富这个库，
	资深的PCB工程师肯定也有自己的元件库，这是长年累月累积下来的，所以可以索要并引用。

	当然，不同的软件的元件库一般不通用

5. 封装/封装库
	封装是针对PCB而言的，对应原理图中的元件，一个元件可以有不同的封装，比如一个ATMEGA128芯片，可以有直插封装，也可以
	有贴片封装，一个电容也有各种型号、大小、容量的不同。

	一般原理图画好之后就要关联封装了

	如果一个元件对应的封装在库中没有（比如封装形式没有 或 大小不同 或 形式不同 或 什么样的都匹配 直接没有等等）就同样需要自己
	来编辑创建新的封装，来丰富这个库 

	***
	要注意，查找封装跟查找元件方法是不同的，当在元件库中搜索元件时，一般直接搜索名字即可，比如电阻搜索R，电容搜索C，电感搜索L，
	芯片直接搜索其名称，比如74HCT574等等。

	但是封装不是通过这些名称查找的，比如74HCT574，这个芯片可能有多种封装方式，比如贴片的、直插的等等，并且还跟尺寸、大小，引脚数
	都有关联，所以查找/关联封装，实际上关注的信息是：
		*封装方式、引脚数量、尺寸信息*

	在英文库中搜索封装方式，首先必须清楚都有哪些封装，其次各种封装对应的英文要知道

		比如330A主板上有一个HC574芯片，首先肉眼观察能知道是什么封装，比如是SOIC（这就需要功底了），然后在封装库搜索SOIC，在KICAD
		的封装库中，列出了不同SOIC封装的信息，因为该芯片有20个引脚，所以找SOIC_20W开头的，找到之后再对应尺寸信息，
		尺寸信息还包含两种：长x宽（有些也需要高度信息），然后是针脚之间的间距信息，这一点也非常重要

		最后找到的封装为：SOIC-20W_7.5x12.8mm_P1.27mm。含义为：SOIC封装、20个针脚、宽x长=7.5*12.8mm，针脚间距为1.27mm

	像封装和针脚一般都是肉眼可见的，但尺寸怎么搞呢？首先能查到手册的先用手册，还不确定的 就需要采购信息了！联系卖家或公司采购，或者公司老员工才能知道具体信息

	注意：有些芯片根据不同的信号可确定其封装形式，如MAX232DR，是SOIC封装的，而MAX232N是PDIP封装、MAX232NSR是SOP封装的



6. Gerber文件

	PCBnew制作好PCB之后，还需要交给厂家来生产，一般有两种方法，一是将当前设计好的PCB文件直接发给厂家制作，这显然暴露多种问题，
	首先软件可能不统一，对方可能根本打不开你的设计文件，更重要的是自己的劳动成果直接被别人看到了，如果被人想抄板或改进，就
	不需要自己制作了，直接在你的设计文件基础上来操作。

	二是使用国际流行的Gerber文件，该文件的格式历史不讨论，一般各种画板软件都可以导出这种文件，该文件描述了PCB的各种信息以用于
	制板使用。

7. BOM表

	Bill of Material 物料清单，是以数据格式来描述产品结构的文件。
	BOM表不是画板软件的专属，许多ERP(企业资源计划)软件都有生成BOM表的功能
	
	如果管理对象是一辆车，那么BOM表就是零部件清单
	如果管理对象是一道菜，那么BOM表就是配料单

	如果管理对象是PCB，那么BOM表就是PCB的部件、材料、尺寸等等信息清单


## 分析
	画PCB涉及到很多知识，很多人上来就学习怎么画PCB，却不关注其底层的知识，对于任何不学习其本质的学习都是徒劳的.

	一个画PCB的软件，可能2~3天就学会了，比如市场流行的AD，Allegro等，如果这么久都学不会，软件公司还怎么好意思收费？
	要知道人家是收费的，我们即是设计者又是软件用户，所以必须有很好的易用性，也就是容易上手，软件公司恨不得你一学就会，
	所以现在有很多AD、Allgero等等各种软件的培训视频，真不知道他们是怎么想的，还真有人去学，我更不知道你们是怎么想的！
	况且现在有很多开源软件更容易上手。

	所以软件不是重点，如果一个软件一个星期还搞不定，那就不用搞了，不是你有问题，就是软件有问题。
	(附：任何软件画PCB板主要就那么几个步骤，大家都是一样的，可能有些在细节上有细微的不同，之前的内容描述了画板的步骤）

	重点是底层知识，最后拼的除了经验还是知识

	------

	比如一个需求到来了，你能理解需求 并 合理的、快速的构建PCB，才是高手
	
	首先用到的就是模电和数电的知识，它们融合在选片、计算等方面，比如选择什么样的芯片？什么规格的芯片？用多大电容？电阻？电感？
	然后就是各种常用电路结构，比如驱动电机的电流桥、ADC读取电路等，还有很多电路是芯片推荐的，照着画就行了，比如MAX232芯片的周边电路

	然后会用到电磁兼容性知识，比如在PCBlayout时怎么布线的抗干扰最强且干扰最少，设计原理图时哪里要加去耦电容等等

	最后，画多层板还需要一点想象力，这点想象力可比最强大脑弱多了，不过还是要有一点的，比如一根线经过过孔深入基层板，再继续走线，这时候
	就不是平面图了，虽然画面上看起来还是平面的。所以这就需要通过2D想象3D



## KICAD库搜索

原理图符号库+电源库

conn 为引脚库前缀，如Conn_01x11_Female 表示1排 11针脚 母口
L	 为电感库
R	 电阻库
C	 电容库
CP	 极化电容
D	 二极管
LED	 发光二极管
VCC	 电源库
GND	 地库
LMxxx 放大器库，这与芯片系列相关
R_v  可变电阻

芯片相关的，直接搜芯片名

GND的种类
	GND					-	标准地 符号
	GNDA				-	GND 'Analog'， 即模拟地，通常用于AD转换中
	GNDD				-	GND 'Digital'，即数字地，通常用于DA转换中
	GNDPWR				-	GND 'POWER'	， TBD
	EarthGND			-	大地，直接连入大地的端口
	GNDClean			-	GND ‘Clean‘， 该地可以阻值噪声，以保证敏感器件的正常运作
	Protective Ground	-	用于保护人的地（而不是连接该地的器件）

	*注意! 不同名称的地（电气）不连接！！ *

## KICAD相关
1. 只要放置了全局标签，那么就要有对应的连接，这个跟网络标签是一样的
2. KICAD的电源
	对于任一类型电源，都需要加PWR_FLAG，目的是告诉KICAD，电源是从某个地方进来的
	注意，GND 也是电源
	在原理图上使用的任何GND和VCC库符号，都属于“输入”电源类型，即表示：将电输入到芯片 或 将地输入到芯片
	所以PWR_FLAG其实是代表“输出”，如它可以表示电是从开关电源输出而来的
	加上PWR_FLAG的方法就是直接在电源库中找到它并且直接连接上各种GND和各种VCC

	比如AVR芯片有AVCC输入也有VCC输入，所以就算建立了AVCC到另一个AVCC的电气连接，DEBUG时也仍然报错“引脚连接其它引脚，但不受任何引脚驱动”
	，解决的方法就是给AVCC也单独加一个PWR_FLAG

![PWRFLAG](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PWR_FLAG1.png)
![PWRFLAG](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PWR_FLAG2.png)

	特殊的问题：
![PWRFLAG](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PWR_FLAG3.png)
	如图，这里不加PWR_FLAG时，DEBUG时就如上错误，当不加PWR_FLAG而去掉上拉电阻时也消除了错误，
	这里原因不明，上拉电阻是不能却的

	猜测可能跟我选择的器件有关，因为图库里没有STC809，其实是TCM809，有可能该器件就需要直接接电源，否则是错误的

	[追加，猜测错误，自己封装了一个元件，结果也是一样的，难道是引脚定义的缘故？？,  其它元件有VCC引脚的，都是直接连接VCC，所以无法对比，暂时妥协，加入PWR_FLAG]

## 关于KICAD的分层处理
	当一个项目较大，当前原理图界面不容易摆放处理时，可以使用分层
	，目的是使用层次结构管理这个项目，
	这样做可以使项目清晰，并且很方便打印处理（比如本来需要在一张A1上画的原理图，可以拆分在几张A4中画）

	关于层次结构，最重要的两件事（核心）：A。如何建立字表  B。如果在子表之间建立电气链接

	A: 
		菜单栏：放置->层次图框，双击当前原理图任一位置，弹出“原理图框属性”对话框，可以修改文件名、图层名文本尺寸等
		，实际上，这是建立摘要的过程，本质就是一个ID。
	
		通过双击刚刚建立的层次图框或者使用分层导航器，可以很方便进入到新的原理图（子表）中画图

		层次图框是要加入“层次引脚"的，所以要适当的大小，(添加层次引脚的方法是先点击“添加图框层次引脚”，然后点击刚刚建立的层次图框（内），弹出对话框输入图框引脚名即可)

		另外，子表还可以建立子表，以此类推

	B：连接的方法是 “层次引脚”和“层次标签”
		其实这两个词是一种概念，只是针对的对象不同，

		层次引脚是针对“发起方”而言的，比如一个表1想与表2建立电气连接，那么表1就需要建立“层次引脚”，而表2要使用“层次标签”，
		表1的每个层次引脚是对应表2的每个层次标签的（如果只是一对一时）

		这里的表2是表1的子表，表1是表2的父表，也就是说父表向任一子表发起电气连接，都必须通过层次引脚（如上，在对应子表的分层图框中建立即可）
		，然后对应的子表中建立同名的层次标签，这样就建立起了父表与子表之间的电气连接

		当然，如果使用“标签”，即全局标签，那么全局标签将贯通所有层次的父子表（含根表），无需特别操作

	
	最后：如果不建立子表，那么根表中应使用全局标签。层次标签仅在建立子表时才使用。
		  删除子表，只需在父表中框选对应的分层图框，删除即可
		



附录A：古老的电路构建方式

1.快速构建
这是一种非常草率的方法，只对构造极其简单的电路原型有用。它通过在任意大小的空间里把元器件焊接在一起来构成非常简单的电路。
![stdExp](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/快速构建.png)

如图，将晶体放在处理器上方，晶体引线直接焊接到处理器引脚，其它引线也焊接到处理器引脚来引入电源和接地从而把处理器的I/O和外部连接起来。
2.面包板
面包板又称电路实验板，是带有排列孔的塑料块儿，它被设计用来盛放DIP封装（双列直插封装）的集成电路和离散元器件。术语“面包板”可追溯到真空管时代，当时真空管无线电设备是建立在一块用于切面包的结实木板上的，因此得名。

![stdExp](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/面包板.png)
使用面包板也不是搭建健壮可靠系统的方法，面包板限制于过多的电容、串扰及噪声敏感度，长期使用后还有机器故障。面包板上的电路连接是通过一段段小的电线来实现的，而这些电线构成了小的天线，这些小天线会吸收周围零散的电磁辐射从而影响电路。
3.绕接技术
绕接曾经是常用的电路构建技术，必须是DIP封装的电路才能使用绕接，它通过约0.6英寸的引脚安装在插座上，然后用绕砸工具（绕砸器和剥线器）在引脚周围绕上电线，这样便构成了一个电路，这也被称为冷焊技术，即不带焊接的一种线与引脚间的紧密电气连接技术。

![stdExp](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/匝绕计数.png)
绕接是一种非常快速的原型技术，且健壮和可靠。在早期，NASA（美国国家航天局）惯于使用绕接技术构建宇宙飞船电子设备，并且许多大型计算机也使用这种技术。




散装知识点
---------

## 去耦电容/退耦电容
位置 ： 放在元器件连接VCC电源之间 和 元器件信号输出端， 去耦电容和旁路电容（放在元器件的信号输入端）相对应

耦合-辞海 : 两个元素/量之间,其中一个量的变化,导致另一个元素/量的变化的一种关系

噪声-辞海 ：信号中 随机变化的 无用的 信号成分。

电路中安装在元件的*电源端*的电容，此电容可以提供比较稳定的电源，同时也可以降低元件耦合到电源端的噪声，间接可以减少其他元件受此元件噪声的影响

去耦电容，是影响了 电源 和 元件 之间的耦合，滤除了电源上的干扰信号，使电源信号稳定, 继而是连通该电源的元器件用电稳定

Q&A:
1. 为什么要去耦？
	A：当一个电源端连接多个元器件供电时，每个元器件的工作都要动态的吸收电流，时多时少，多个元器件一起工作更会影响电源的稳定（直流的波形开起来像交流），这不但会影响元器件的供电，
	也会产生电磁噪声影响周围系统，是元器件和周围系统产生错误的信号，所以在电源向元器件的输出端加上一个电容（称为去耦电容），用来减小或消除影响。

	B: 当元器件输出信号时

2. 为什么电容能去耦？
	去耦原理 ：因为电容是储能元件，当电压突变高时电容吸收多余电量，当电压突变低时电容释放存储电量补充

3. 选型与放置
	基本原则：最小化电阻(ESR)、最小化电感(ESL)

	电容还具有阻抗和电感属性，对于电阻而言无论频率如何都呈固定阻抗，对于电感而言随着频率的增加而增强
	容量选型：
		电容式储能元件，当在电源端用作去耦功能时，还可以实现“蓄能”功能，即用来补偿电源的长期偏差（长期偏差可能是开关电源到PCB电源的距离较远，且负载较大，导致长期供电不足）
		，如果需要补偿电源的长期偏差，则需要大量存储电荷，即选择大容量去耦电容

	种类选型： 陶瓷电容 具有很小的阻抗和电感，其次是钽电容 ， 另外贴片电容的效果更好

	放置    ： 电源 - 去耦电容 - 地，三点一线，呈最佳效果

![decoupling capacitor](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/去耦电容位置.png)

	去耦电容可以并联使用(相同/不同容值)，已达到更好的去耦效果

又见层
------
1.信号层Signal layers
	a)顶层 TopLayer
	b)底层 BottomLayer

2.内层Internal planes

3.机械层 Mechanical layers

4.屏蔽层 Masks

a)阻焊层 Solder
	i.顶部阻焊层
	ii.底部阻焊层

b)锡膏层	Paste
	i.顶部锡膏层
	ii.底部锡膏层

5.丝印层 Silkscreen
	a)顶部丝印
	b)底部丝印

6.其他层
	a)禁止布线层 Keepout
	b)多层 MultiLayer
	c)钻孔指示层 Drill guide
	钻孔参考层 Drill Drawing


芯片及相关术语
---------------------

## 总线驱动器：

一．解释
	MCU具有一定的负载能力，如果外设过多或所需驱动电流/电压导致MCU负载能力不够，就需要驱动器来提升驱动能力。总线驱动器具有很大的扇出系数，可将输入逻辑信号进行功率提升送到输出端。总线驱动器一方面可实现对总线的驱动，另一方面也可实现对总线的隔离，隔离的能力还是来自于三态门。
功率提升的本质是电流的提升。
二．应用
	在屏幕显示及大部分消费类电子产品中常需要驱动器。


## 译码器：

译码是编码的反过程，是将二进制代码翻译成特定的输出信号。

分类：
1.	二进制译码器
	又称n->2ⁿ线译码器，即将n种二进制输入组合翻译成2ⁿ种高低电平信号。
	74HC138是二进制译码器中的一种

2.	二 - 十进制译码器
	将二进制代码翻译成十进制数。这种译码器有4个输入端10个输出端。

3.	显示译码器
	将二进制代码翻译成显示器可显示的数字或文字。


## 时钟

	时钟 = 协调

	协调系统部件工作节奏

	各干各的是不行的

	必须有统一的节奏（注意是统一而不是同一，如：部件A的工作节奏[频率]是1秒中100次，部件B的节奏为2倍的A
	，这是统一的节奏，也可以说是所有部件/器件的工作频率是可以相互逻辑推算的）

	它的角色像人体的心脏，像乐队的指挥家

## 三态门

### 概念
	TTL电路只有高电平（1）和低电平（0）两种状态，而三态门（TSL）具有高电平、低电平和高阻态（Z）三种状态，故称三态。三态门的核心就是高阻态的应用，在半导体电路结构中不可能使用闸门开关来闭合电路（设计上和速度响应上都是不现实的），而高阻态（电阻无穷大）可以被认为是开路状态，起到了半导体电路的开关作用 - 半导体电路控制开关。

### 符号 
![三态门](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/三态门.png)

### 应用	
	1. 总线的分时复用
		三态门主要用于TTL电路与总线间的接口电路，如果一个设备要挂到总线上，则必须要经过三态门，因为总线上一个时刻只能与一个设备通信，此时其它设备要呈高阻态

	2. 数据的双向传输
		通过两个三态门的设计可实现一根线路的双线传输
![三态门](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/三态门2.png)

## 牛屎芯片/牛屎封装
DICE:
DICE 也叫 CHIP 或裸片，是没有封装的芯片
(常见芯片是黑色的矩形外壳，四周或者下面会引出许多金属脚，这种芯片就是标准封装。标准
封装已经规定好引脚的位置和大小，这样进行产品开发时候只要知道用的是什么封装就知道电路板
应该怎么布线)
这种芯片需要通过一种叫 BONDING（邦定）的方法将芯片上的引脚用非常细的线连出来,，再点上胶直接固定在电路板上

另外有的时候担心产品的程序被人复制，这样比用标准封装程序被复制的难度要大许多，标准封装只能依赖单片机
自身的防复制功能和把上面的丝印磨掉不让别人知道是什么型号的单片机来进行


现代诸多电子产品的 PCB 板上看到纽扣大小的黑色芯片,大家管它叫做“牛屎” 。其实它真正的学名叫
做绑定(bonding )，也就是芯片打线,芯片覆膜,音译为邦定， 是“ bonding ”的音译，是芯片生产工艺
中一种打线的方式，一般用于封装前将芯片内部的电路用金线与封装管脚连接。一般 bonding 后(即电路与
		管脚连接后)用黑色胶体将芯片封 装, 同时采用的外封装技术 COB(Chip On Board),这种工艺的流程是将
已经测试好的晶圆植入到特制的电路板上， 然后用金线将晶圆电路连接到电路板上，再将融化后具有特
殊保护功能 的有机材料覆盖到晶圆上来完成芯片的后期封装。
![牛屎芯片1](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/牛屎芯片.jpeg)
      
使用邦定技术的芯片又叫 “裸芯” ， 即半成品芯片。 由于本身已经具备了最基本的控制功能, 所以在
刚开始使用时与封装芯片并没有什么不同， 但由于省去了很多后续工序， 如没有增加 必要的保护电路，它
的使用寿命与稳定性都要比最终完工的封装 IC 集成芯片低很多，一旦坏了没得维修，一般只有整个报废，
其成本也只有硬封装 IC 集成芯片的 1/2到 1/3。

![牛屎芯片2](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/牛屎芯片2.jpeg)

第一，牛屎芯片的封装工艺环境天生就不够塑料封装好，起码滴胶工艺的净度就绝对比不上正规硬封装厂家
的芯片。
第二，牛屎芯片的缺点，底衬不能很好的焊接或者是焊接不牢靠、受热受潮或者是受冷冻之后底衬可能会接触不
良、黑胶密封性差、对潮湿环境和静电抑制能力差、易老化、损坏无法维修。
第三，牛屎芯片的优点就是开发周期短、封装成本低、适用于比较简单的电路。
第四，同一个等级的芯片，用牛屎封装同用塑料封装，肯定是塑封好。牛屎的故障率肯定比正常的塑料封
装要高

## 逆变器
逆变器一般有6个功率晶体管（q1~q6）组成，分为上臂/上桥（q1、q2、q3）和下臂/下桥（q4、q5、q6）
它有将直流转换为三相交流 和 控制电流导通的开关功能。

## 缓冲器
缓冲器分输入缓冲器和输出缓冲器两种。前者的作用是将外设送来的数据暂时存放，以便处理器将它取走，后者的作用是用来暂时存放处理器送往外设的数据。有了数控缓冲器，就可以使高速工作的CPU与慢速工作的外设起协调和缓冲作用，实现数据传送的同步。由于缓冲器接在数据总线上，故必须具有三态输出功能。
74HC244是缓冲器的一种
该芯片用于数据同步以解决MUC与外设速度不匹配的问题，同时增强MCU的负载能力以驱动更多外设，又因其具有三态门，故还有隔离保护功能。

## 继电器
1. 光电耦合器
optical coupler
简称OC

又叫光电隔离器，简称光耦

它将发光器和受光器封装在一个管壳内，来实现无接触式/绝缘式的 电 - 光 - 电 的转换

发光器通常是一个发光二极管、受光器为一个光敏半导体管

拥有体积小、寿命长、无触点、抗干扰强、输入输出绝缘等优点

MOC3020 是其中一款产品。

## 触发器
在实际的数字系统中往往包含大量的存储元件， 且经常要求它们同一时刻同步动作，为达到这个目的，在
每个存储单元电路上引入一个时钟脉冲（CLK）作为控制信号，只有CLK到来时电路才被“触发”而动作，并根据输入
信号改变输出状态。
这种在时钟信号触发时才能动作的存储单元电路，称为触发器，以区别没有时钟信号控制的锁存器。

D触发器是触发器的一种，它在时钟脉冲CP的前沿（正跳变0-1）发生翻转。D触发器的应用很广，如数字信号的
寄存、移位寄存、分频和波形发生器等。

74HC574是D触发器中的一种芯片

## 存储器
KEY: RAM ROM 存储阵列 行列译码

### 简介
	存储器是计算机的数据记忆存储设备，用具有两种稳定状态的物理器件来存储信息（二进制数据）。按存储介质可分为半导体存储器和磁表面存储器，按功能作用可分为主存储器、辅存储器、高速缓冲存储器、控制存储器等。
	半导体存储器由半导体芯片制成，可存在于片内（如CPU内部）、片上（板载）或成为独立设备（如内存条），可用作主存储器、高速缓冲存储器和控制存储器，如ROM、RAM、Register，也可用作辅助存储器，如FLASH。磁表面存储器由载体和磁性材料组成，常用作辅助存储器，如磁盘、光盘、磁带等。

### 半导体存储器
	根据摩尔定律，半导体芯片每2~3年革新换代一次，从1970年至今半导体芯片晶体管集成度已达数十亿级别，其中半导体存储器占芯片的大部分面积。主要分为四大类：只读存储器ROM、随机存取存储器RAM、寄存器Register和闪存Flash
![PC](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PC-memory.png)
![memory](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/存储器分类.png)

1. ROM -  Read-Only Memory，只读存储器，又称程序存储器。ROM在制作时或制作后写入数据，在工作时只能进行读操作，断电后数据不丢失，通常只有几十k或几百k的存储容量，常用于存储固件。按制作工艺可分为掩膜ROM-MROM（制作时形成数据）、可编程ROM-PROM（制作后一次性写入）、可擦可编程ROM-EPROM（紫外线照射擦除，可多次写入）、电可擦可编程ROM-EEPROM（电擦除，可多次写入）。

2. RAM- RAM - Random Access Memory，随机存取存储器，又称数据存储器。RAM可以随机存取，速度快，但断电后数据丢失，通常有几M、几百M或几G的存储容量，用于操作系统下的数据的临时存储。RAM分为静态RAM（Static RAM - SRAM）和动态RAM（Dynamic RAM - DRAM）

	A: SRAM
	SRAM分为MOS型SRAM（NMOS、CMOS）和双极型SRAM（TFT），由于SRAM的复杂电路结构，使得成本要比DRAM高很多，而且集成度低，一般只有几十K~几百K或几M存储容量。
	SRAM读写速度极快，功耗低，常用作高性能微处理器中的高速缓存（Cache）。SRAM在工作时电路不需要刷新，只要供电就会一直存储数据，断电后数据消失。SRAM由三部分组成：存储单元阵列、（行/列）地址译码器、读写电路。

![行列](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/行列译码器1.png)
	存储容量常写为乘法形式，如：“2Kx8位”，表示存储容量为16Kbit或2KByte，并可推导该芯片的地址总线数：“2K=2^11，有11根地址总线”；8位表示有8根数据总线，8个存储元视为一个存储单元。同一容量的SRAM有不同的存储实现方式，如：“1Kx16位、2Kx8位、4Kx4位、8Kx2位、16Kx1位等”；并可以是单片形式，或者通过其它存储阵列并联组成。
![行列](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/行列译码器2.png)

3. FLASH
	闪存是EEPROM的发展，又兼具RAM的特性，其集成度高、功耗低 、体积小 ，又能在线快速擦除
	Flash可归属ROM家族，因其特性单独讨论，安卓手机上常提到的ROM通常指FLASH，而不是MROM、PROM、EPROM或EEPROM等。

4. EEPROM 及 存储保护
1.软件
A.上电延时
B.存储备份和恢复
2.硬件
A.MCU自带功能,如AVR的BOD功能
B.大电容防止存储掉电

## PAGE / BANK

PAGE/BANK一般出现在简单的单片机中，PAGE对应于ROM，BANK对应于RAM，作用基本一致

BANK这里当做“储存块”来讲

有些指令只能操作很小的地址范围，通过BANK的方法（通过寄存器配置选中哪一部分来操作）可以将指令寻址大大增加，BANK
也同时增加了程序复杂性

## CISC/RISC

复杂指令集与精简指令集

CISC具有大量的指令集，并增加硬件复杂性以满足用户的需求

RISC则反之，只拥有较少的指令，而把复杂性嫁接到软件复杂性上

一般CISC有几百条指令，而RISC只有几十条指令

目前PC机的CPU基本上都还是CISC指令集的，

RISC 和CISC 的区别：
①RISC 指令系统较小，种类的数量较少，只提供简单指令。CISC 指令系统大，种类的数量多，
提供各种指令。
②RISC 指令长度、寻址方式、格式都整齐划一，这样可以充分利用流水线，基本上可实现一个
时钟脉冲执行一条指令。CISC 指令长度、寻址方式、格式不一，难通过流水线方式提升指令执行效
率，无法做到一个时钟脉冲执行一条指令。
③RISC 的函数调用将现场状况保存在专用寄存器中来提升效率，参数也使用寄存器传递。CISC
的函数调用一般通过堆栈保存现场，需要内存操作，效率要低

## 专用单片机的辉煌与落寞

### 冯·诺依曼结构与哈弗结构
冯诺依曼结构（也称普林斯顿结构）是计算机的启蒙结构，也是使用了相当长一段时间、并且现在计算机仍然在采用的计算机体系结构，

冯诺依曼提出 程序（指令）和数据 共用同一组地址总线和数据总线，这样 读取程序代码和数据就不能同步运行

哈弗结构将 程序（指令） 和 数据 分开存储， 使用两条独立的总线，如此哈弗结构单片机片内至少存在4套总线：指令数据总线、指令地址总线、数据的数据总线、数据地址总线
，显然，哈弗结构可以同时获取指令和数据，互不干扰，效率更高

这就是冯诺依曼结构和哈弗结构的主要区别：哈弗结构少了一次总线切换。

### DSP

DSP就采用了哈弗结构，但只是采用哈弗结构不能显著提示单片机效率，于是DSP增加了很多硬件设备，如乘法器，对于没有乘法器硬件的单片机来说，实现一个乘法可能需要几十条
、上百条的指令，而有了乘法器，一个指令周期就将乘法搞定。
同时DSP还使用了流水线设计，使得原来的"取指、译码、执行“三步在一个信号周期内就完成了，即在执行指令的同时对下一条指令译码并同时取得下一条指令，真正的流水线更加复杂
会有很多的优解。

DSP是专门对数字信号处理作出的设计，在处理数字信号时会比冯诺依曼结构快很多，但如果用DSP实现简单的逻辑控制并不一定比冯诺依曼结构快

不是所有的单片机都是冯·诺依曼结构，在移动数字通讯刚刚兴起的年代，DSP 那是望尽春色，
近年来随着技术的发展单片机的速度是越跑越快，有一些单片机也开始采用哈佛结构，少数单片机
内部甚至会加上一个小的DSP 核，使得DSP 在数字处理速度方面的优势逐步变小，加上一些专用器
件内部采用硬内核进行数据处理，这些变化恐怕让DSP 难以再现昔日辉煌。

这不仅仅是DSP的过程，也将是许多专用单片机的故事，将来或者是现在，一个ARM-A9或许可以把所有单片机都替代了

## 术语

MIPS ： 百万指令每秒
EMC/EMI : 电磁兼容，也就是抗电磁干扰和减少自己对外的电磁干扰

SMT/回流焊/波峰焊 :
这几个都是生产焊接设备的名字，
	SMT 是自动贴片机，适合高速生产，设备昂贵，对操作员也
有一定的技能要求；
	回流焊是为了让小工厂焊接贴片元件的一种低成本方法，先做一张钢网，这个
钢网上面在焊接贴片元件的焊盘位置挖出一样大小的小洞，让后将电路板和钢网放到一个类似油印
机的架子上，将锡浆刷到电路板焊盘位置，再人工将元器放上去，经过回流焊设备就完成了焊接；
	波封焊那就是更简单的生产设备，用于插接件的焊接，这个设备实际上就是一个大锡炉，插好元件
的电路板从上面经过就将裸露的焊盘焊好，后面再用电锯一样的剪脚机把元件的管脚剪短


## 74系列芯片
74系列芯片是TI德州仪器、NXP恩智浦、ST意法半导体等半导体公司生产的中小规模TTL集成电路芯片，主要用于计算机数据的输入、输出、锁存等处理，工作温度在-40~85℃之间。该系列芯片以74开头，连接字母或数字以标识不同功能。

例：74XXX 标准型TTL、电压2.4V、传递延迟9ns、功耗10mW。74LXXX低功耗TTL、电压2.4V、传递延迟33ns、功耗1mW。74HXXX高速型TTL、电压2.4V、传递延迟6ns、功耗23mW。

芯片最后的一个或几个字母，表示封装方式，不同厂家有不同标记方法，一般D表示SOP封装，如74HC138D

74或74+字母之后的数字表示该芯片的逻辑功能，不同的字母，相同的逻辑数字，其逻辑功能一样：
如：74LS224与74HC224的逻辑功能是一样的

附：
秒   1s = 1000ms
毫秒 1ms = 1000us
微秒 1us = 1000ns
纳秒

## ADC

### 简介
	ADC（Analog to Digital Converter）也称A/D，即模/数转换器，是将外界连续变化的模拟信号转换为离散的数字信号的电子元件。ADC最早用于无线电台中无线信号向数字信号的转换。与ADC对应的电子元件为DAC数模转换器

### 分类
	有多种ADC类型：并行、逐次逼近型、积分型、∑-Δ型、流水线性，低功耗、高速、高分辨率是ADC的发展方向。其中并行ADC是当今速度较快的模数转换器。
	AVRATMEGA128集成逐次逼近型ADC

### 指标

#### ADC 采样率和分辨率 是两个重要的参数

分辨率 - 模拟量量化为数字量的精度 - 量化精度（也称ADC精度，位数）
采样率 - 模拟量量化为数字量的速率 - 量化速率（单位SPS，或b/s或Hz） 
- 采样个数/采样时间 - 单位时间内采样个数 
- 显然采样率与分辨率有关，- 分辨率越高，样本数量越大，单位时间内采样数量越大，采样率越高
- 如果采样率可配置，则分辨率固定的情况下，增大采样率，同一时间内可采样更多样本

采样率是与分辨率有关联的，ADC手册经常看到的参数描述如："8位分辨率下采样率79kSPS , 最高分辨率时采样率高达15 kSPS"
因为采样率表示数字量 ，数字量量化为模拟量的速率 ，ADC精度高，则代表的数值范围越大，数字量变多，所以相同时间内采样速度变慢
所以分辨率越高，采样率越小。它们之间可能没有固定比例关系，应该跟不同的ADC有关。

有些ADC的采样率和分辨率是可配置的。有些则不能，如ATMEGA128，分辨率固定为10位，采样率为15kb/s

![采样频率1](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/采样频率1.png)
![采样频率2](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/采样频率2.png)

采样率与奈奎斯特频率：采样率应至少为采样信号频率的两倍，(从这个角度讲，ATMEGA128不能对信号频率大于7.5kHz的进行采样??),
	如果低于这个频率，采样信号失真.

![奈奎斯特1](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/奈奎斯特1.png)
![奈奎斯特2](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/奈奎斯特2.png)

#### 基准电压

基于参考电压来将模拟量转换为数字码，因为数字电路只认高低电平，所以如果没有参考电压ADC读取来的电压值将是无意义的，（数字信号本身不具实际意义，仅表示相对大小1/0）而这参考电压又称基准电压，其指标是温漂，一般用ppm/K表示。
假设ADC的基准电压为5V、输入电压3V，则输入电压/基准电压=60%，对于8位ADC而言，该模拟量代表256X60%=153（0X99）。
公式：Dadc = 2n X ( Vadc / Vref )，其中n为ADC精度。
可见输入电压大于基准电压时ADC达满精度（满量程），输入电压为0V时，ADC为最小精度0。再设计上，基准电压最高值应该等于参考电压，如果基准电压不够，则可以使用功率放大器放大或使用ADC自带的增益。

#### 单端与差分输入通道

单端输入是指被测电压从某个引脚输入，其参考电压是内部电压或GND。差分输入需要两个输入引脚，其参考电压时两个引脚彼此之间的相对电压。其中单端输入方式较为常见。
单端方式适用于传感器到ADC的线距离较短（5m以下），且所有输入信号要共用一个基准地。差分输入适用于更长距离的数据传输，更适用于噪声较大的使用场景。
 
如图所示，单端输入只有一个输入引脚ADCIN，使用公共地GND作为电路的返回端，ADC的采样值=ADCIN - GND(0V)。这种输入方式优点就是简单，缺点是如果VIN受到干扰，由于GND电位始终是0V，所以最终ADC的采样值也会随着干扰而变化。
而差分输入比单端输入多了一根线，最终的ADC采样值=(ADCIN+) - (ADCIN-)，由于通常这两根差分线会布在一起，所以他们受到的干扰是差不多的，输入共模干扰，在输入ADC时会被减掉，从而降低了干扰，缺点就是接线复杂一些。而且需要VIN+和VIN-两路反相的输入信号。

![通道1](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/ADC通道1.png)
![通道2](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/ADC通道2.png)

其它术语参考：https://www.maximintegrated.com/cn/app-notes/index.mvp/id/641
https://zh.wikipedia.org/wiki/%E9%A1%9E%E6%AF%94%E6%95%B8%E4%BD%8D%E8%BD%89%E6%8F%9B%E5%99%A8


	---------------------------实验记录

	热敏电阻测温实验，
	设置ADC时钟分频为2（CPU时钟16MHz），时钟频率为8MHz，发现Vadc = 4.99，Dadc = 1023。
	设置为4分频时，时钟频率 = 4MHz，Vadc和Dadc的值正常。
	设置8分频、16、32、64、128分频都正常。

	原因未知。

	------------------------------

### Other
	ADC串联电阻的意义：关键词：数字电源、模拟电源、隔离、去耦、ADC性能、数字瞬态电流

## TTL与CMOS电平
	TTL电平：晶体管-晶体管逻辑电平，是计算机电路中的标准电平，它使用+5v=逻辑1、0V=逻辑0。

	TTL与CMOS
	TTL电路速度快、延迟小、功耗高、抗噪声能力差
	CMOS电路速度慢、延迟高、功耗低、抗噪声能力强

	TTL电平的实际标准
	输出：
	高电平 - >2.4V
	低电平 - <0.4V

	输入：
	高电平 - >2.0V
	低电平 - <0.8V

	CMOS电平的实际标准
	低电平（逻辑0）
	输入 - <0.3 * Vcc
	输出 - <0.1 * Vcc

	高电平（逻辑1）
	输入 - >0.7 * Vcc
	输出 - >0.9 * Vcc

	可见CMOS电平的高低电平取值是依电源电压而定的
	，高电平接近电源电压，低电平接近0

# 晶振

晶振是单片机系统的指挥家，它发布统一的工作节奏，注意，是统一而不是同一，统一意味着A吹两下笛子，B就得拉四次小提琴，这样不同的乐器
在统一的指挥下才能演奏出动听的交响曲。
晶振 就是 晶体振荡器，或 石英晶体振荡器， 石英这个东西就厉害了，他就是二氧化硅，天下物料之集大成者：玻璃、光纤、玛瑙、水晶、单片机等等。

石英晶体具有压电效应：给晶体薄片施加电场，晶体会形变，当移除电场时，晶体恢复形变并释放电场，如此往复形成固定的震动频率

RC振荡器（电容和电阻组成的振荡器）也可以作为触发信号源，但稳定性比晶振差、如果产品对时间精度要求不严格（比如一种按键发光的儿童玩具）就可以用RC
振荡器来节约成本

选多快的晶振？是不是单片机要跑多快就用多大的晶振？
NO！频率越快，越容易产生电气噪声干扰，越难以控制，并且晶振对电路要求很高（在距离和走线上等等），如果放置不当还不会正常工作。
晶振作为一个外部器件，要提供的频率应该越稳定越好，而不是越快越好，那单片机需要更快的振荡频率怎么办呢？
这就需要*锁相环* PLL 技术来解决，该技术可以将晶振频率加倍（N倍），进而实现更高的振荡频率
另外PLL还具有动态改变工作频率的能力
此外，还有分频器，即将晶振频率(或其它频率)分解的更小来使用


通过上述知识可知，通过晶振振荡可将震动传递给单片机内部，单片机内部可以通过倍频或分频技术来利用，无论倍N频还是分N频，显然都必须具备N是整数
，通过将外部晶振 倍频和分频得到的震动频率，就是*系统时钟*


# PCBA 测试架

BA简介
PCBA（Printed Circuit Board +Assembly）又写作PCB’A，是指对PCB空板进行SMT贴片和DIP插件的装配过程，也指通过该过程生产的成品印刷电路板。PCBA测试是对完成焊接的PCBA板进行程序烧制和有关通路、环境、电压、电流、压力等方面的测试，是PCBA加工过程中的一个重要环节，处于生产工序的末端，是严控出货品质的重要手段。
目的：PCBA板在生产的过程中，由于受到生产材料、生产人员以及设备等各种因素的影响，很难确保生产出来的PCBA板是完好的。因此，需要进行PCBA测试。
意义：PCBA测试处于生产环节的后端，能够在最后阶段及时发现PCBA的缺陷，方便对前端工序的SMT贴片加工和DIP插件加工进行调整，起到优化内部的工艺制程的作用。
二．PCBA测试方式及PCBA测试架
小批量生产的PCBA可以借助专业测试设备或手工万用表的方式对测试点检测，对于大批量生产的PCBA测试则要使用测试架（Fixture）来辅助完成。
PCBA测试架又称PCBA测试治具，其原理是通过测试顶针与PCB板的测试点连接，从而获取电路中的电压、电流等关键数据，并在测试架的显示屏幕上显示，达到快速检测的目的。客户在设计PCB板时，就应该考虑其测试方案并预留PCB测试点，然后出具专业的测试文档或测试方案给制造商。
制作PCBA测试架要提供的文件：http://www.nodpcba.com/news/2609-cn.html。
三．测试分类及原理
PCBA测试的方法主要包括：ICT测试、FCT测试、老化测试、疲劳测试、振动测试、高低温测试。
1.ICT测试 - 导通性测试
ICT又称在线测试仪，ICT测试主要是通过测试探针接触PCB的测试点来检测线路的开路、短路以及PCBA板上元器件的焊接情况（不涉及到功能按键或者输入输出方面的测试）。ICT测试具有操作简单、准确性高的特点。一些中低端的PCBA板可专门制作ICT测试治具，可有效的降低测试成本。
2.FCT测试 - 功能性测试
FCT测试由又可称为PCBA功能测试，是指对目标内部功能的测试，可对测试目标提供模拟的运行环境（激励和负载），使其工作于各种状态之中，以测量输出端的参数是否符合要求。测试的内容主要包括电压、电流、功率、功率因素、频率、占空比、亮度与颜色、字符识别、声音识别、温度测量、压力测量、运动控制、FLASH和EEPROM烧录等。
3.老化测试
老化测试是指对PCBA板进行长时间的通电，进行输入输出方面的测试，模拟用户的操作，以确保其性能符合市场的要求。
4.疲劳测试
疲劳测试是指对PCBA进行高频、长时间的操作，观察是否出现失效，判断测试出现故障的概率，以此来检查PCBA板的工作性能。
5.震动测试
震动测试采用专业的震动测试仪进行长周期测试，确保焊接元件无任何脱落情况出现，抽样测试比例根据客户要求决定。
6.高温测试
高温测试是指将PCBA放入测试房，并针对性地提供-40℃至100℃等常见温区的测试服务，充分模拟产品的环境温度，最大化确保产品的可靠性。
注：也有分类将震动和高温测试归为恶劣环境测试，恶劣环境下测试主要是将PCBA板暴露在极限值的温度、湿度、跌落、溅水、振动下，获得随机样本的测试结果，从而推断整个PCBA板批次产品的可靠性。
四．价格
1.PCBA测试架的价格
PCBA测试架是需要定制的，不同的PCBA板和同一块板的不同测试点都需要不同的测试架，在淘宝上有出售PCBA空测试架，买回来后可以根据自己的需求加工，商家也有提供加工的，按100个测试点算，加工好不接线需700多元（不含税、不含运费）。
2.PCBA代测试的价格
通过电话（广州市诺的电子有限公司）了解到，直接拿成品板给代测试服务公司是没有意义的，它们需要监控整个生产过程，所以需要生产、加工、测试一体化，客户需要提供BOM表和测试需求，具体价格跟BOM表、测试需求、加工精度、测试架材料等都有一定关系，暂无法确定具体价格。

附录A：PCBA测试材料与价格的关系

1.测试探针
目前测试探针分国产、台湾香港、进口三种。进口产品一般是德国、美国、日本的产品，品牌有INGUN、TCI、日电、华荣、中探、亚探等。测试探针的质量主要体现在材质、镀层、弹簧、套管的直径精度及制作工艺。目前包括国内的产品其材质很多用进口材质，所以除非是偷工减料一般探针材质问题不是很大，针及套管的直径精度方面国内与台湾香港的产品差不多，进口稍好但一般影响不大，弹簧及镀层的质量这方面进口产品比国内要好很多，台湾香港产的比国内稍好一些，原因主要是工艺水平上的差别，国产的探针镀层抗磨损较差镀层容易脱落。如果制作的测试治具使用时间及测试次数超过15万次以上选用进口产品较为合适，但进口的探针价格较贵。目前国内的制作水平和工艺逐步提高，并且在当前价格大战的情况下，不少代理商用国产针冒充进口或台湾产的探针出售。如果测试要求和测试次数不高的话建议可选用国产探针。探针的质量主要对测试治具制作中的测试次数及接触是否良好有关。
2.测试线
目前测试线都是国外进口或台湾香港地区生产，其产品的区别好像不大。价格为125元左右一卷。
3.测试板材
测试治具中所选用的板材一般有压克力（有机玻璃）、环氧树脂板等。普通的探针孔径大于1.00毫米的治具，其板材以有机玻璃居多，有机玻璃价格便宜，同时有机玻璃相对较软钻孔时有胀缩探针套管与孔的结合紧密，由于有机玻璃是透明的治具出现问题检查十分容易。但是普通的有机玻璃在钻孔时容易发生溶化和断钻头，特别是钻孔孔径小于0.8毫米时问题很大，一般钻孔孔径小于1毫米时都采用环氧树脂板材，环氧树脂板材钻孔不容易断钻头其韧性及刚性都好但价格较贵一些，环氧树脂板没有胀缩所以如果钻孔孔径不精确会造成探针套管与孔之间很松动产生晃动。环氧树脂板不透明如果治具出现问题检查较困难一些，另外有机玻璃温差变形比环氧树脂板大一些，如果测试的密度非常高的需采用环氧树脂板。板材的选用及钻孔的精度对整个测试治具的精度起关键的作用。
治具的底座大部份是用PVC或有机玻璃制作的，大部份的厂家制作治具底座时是根据测试板材的大小临时制作的，所以底座的质量及底座的重复使用率不是很好，所以建议统一底座大小及标准，本网站提供二种标准的底座可适用大部份的专用测试机，其材料采用20毫米的有机玻璃，由有机玻璃厂家制作质量及工艺非常好，可重复使用，价格虽然稍贵但物有所值。

# I/O复用奇数

为了单片机增加I/O功能，又不能增加I/O管脚数量，只能将IO做成复用的，即一个接口可以有多种功能
不同的功能配置，通过单片机寄存器配置来完成

## IO与GPIO
IO就是输入输出，在单片机中代表输入输出接口，GPIO是近来兴起的说法，意为“通用IO”，都是一样的，叫法不同而已


# 上拉电阻

将不确定的信号接口，通过一个电阻拉在高电平，这个电阻就是上拉电阻，电阻同时起到限流的作用
下拉电阻就是将不确定的信号接口，通过一个电阻拉在低电平，这个电阻就是下拉电阻



# PWM

PWM即脉宽调制，其本质原理是“恒流斩波”：改变负载开关的开关频率或直流电流的接通和通断时间，就可以改变加载到负载上的电压和电流的平均值。从这个意义上说，PWM类似与负载串联的可调电阻。
(具数据统计，使用直流斩波器代替变阻器可节约电能约25%，利用直流斩波原理制作的器件角DC/DC，这一原理还实现了PWM技术。)
	PWM可以用软件模拟，也可以用硬件实现，在计算机中通常使用定时器来产生PWM。通过软件模拟，即通过延时来调整高低电平的输出时间，进而调整脉宽。脉宽即脉冲宽度，脉冲与脉宽是两个概念。
	While(1)
{
	PORTA = 0XFF;
	DELAY(1);
	PORTA = 0X00;
	DELAY(1);
}
该代码可产生占空比为50%的方波，占空比表示一个PWM周期内有效电平所占时间与整个周期的比值，有效电平通常指高电平，在一些应用中也可能是低电平。

![stdExp](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PWM1.png)
上述图示PWM占空比为50%，红色部分表示PWM一个周期。
高峰表示Vcc，低谷表示GND
![stdExp](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PWM2.png)

实际产生的电压值为(Vcc - 0v)x50%

PWM占空比为100%时的情况，此时负载电压为Vcc，以最高能量工作。
![stdExp](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PWM3.png)

PWM占空比为0%的情况，此时负载电压为0v，不工作。

![stdExp](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PWM4.png)

PWM可以用来驱动电机以，通过调整占空比，进而调整步进电机电压，从而控制其转速。
PWM也可以驱动LED灯，通过调整占空比，进而调整LED电压，让其产生“呼吸”效果。

可见要产生PWM，就必须实现快速的开关通断，这个速度是如此之快，以至于手工和机械都是完成不了的，所以必须使用继承电路IC实现。

PWM作为一种波形，携带这两种信息，一个是脉宽->占空比，另一是频率，前者是主要信息，是PWM的本质，后者是任何波形都携带的信息。脉宽信息决定着实际输出电压，频率信息决定着脉宽信息的改变速度。比如，当PWM用于驱动LED呼吸时，PWM脉宽决定了LED的呼吸（脉宽从0%~100%~0%改变），而PWM频率信息决定了LED的呼吸速度。又比如，当PWM用于驱动电机时，PWM脉宽决定了电机速度，而PWM频率决定了电机切换速度的速度。

附：PWM波是非正玄波，这使得输出的能量不能得到充分利用，于是产生了正玄波脉宽调制SPWM、SVPWM。

附：简易的呼吸灯设计
![stdExp](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PWM-呼吸灯.png)

整个程序分两段，在死循环中，前段为PWM产生代码，后段为闪烁方向设计。闪烁方向设计让呼吸灯从”亮到灭到亮”变化，否则“从亮到灭，从亮到灭”变化。
要注意，上述程序延时使用微秒，而不是毫秒或秒，微秒级别的延时让人的眼睛看不到灯闪烁的过程（为了产生PWM只能让让灯亮灭），这里也利用了人类的视觉暂留原理，实际上灯是在飞速的闪烁，要看到这个效果，只需把微秒改成毫秒即可。
还有，数值一定要连续，才能使PWM模拟从0~5V的持续电压变化，如果给定数组查表，而不是从0累加，那么数组值一定要密集（采样足够多），否则也会产生毫秒级别的闪烁。（也可以理解为，要使尽量使PWM接近正弦波）
最后，改变微秒级别的闪烁值（setTimeCount），就可以改变灯的呼吸速度，从上述程序中也可以看到，一定要保证PWM周期固定，然后改变亮与灭的占空比即可。


附：通过示波器测量，上述程序产生的是方波，PWM本质就是方波，所以测量无误，即便程序模拟使PWM近似正玄波，但结果还是方波。
测量晶振结果为正弦波（晶振产生的是正弦波，通过电路滤波后形成供电路系统使用的方波）
![stdExp](https://github.com/Jim-CodeHub/Skills-list/raw/master/image/PWM-N.png)



PWM恒流斩波效果的实现需要PWM周期足够小

(一般刷新频率子60Hz以上就可以了，这个跟电脑显示器的刷新频率一致，一般PC机显示屏的最低刷新频率是60Hz，即1秒刷新60次[即16.7ms/次])

如果一定要使用较大周期怎么办呢？

比如1s为周期可以实现恒流斩波效果

10s呢？

10s就必须将其均匀化！

如果在1s时使用的是50%方波，则在10s周期时，每1s都分为两部分，这样10s就被分为20个部分，其中10个部分为50% HIGH level，另外10个部分为50% LOW LEVEL
如此就在比较大的周期中实现PWM效果了！

如果在1s时实现的是20% · 80%

同样在10s周期中将每1s都实现20%~80%

这样，无论在多长的周期中，都可以实现PWM效果

代码

// 20% 占空比 PWM周期1s

delay(0.2)
	PORTA = 0X00;
delay(0.8)
	PORTA = 0XFF;

	// 20% 占空比 PWM周期5s 1s均化

	for(int i=0; i<5; i++)
{
	delay(0.2)
		PORTA = 0X00;
	delay(0.8)
		PORTA = 0XFF;
}


占空比才是真正PWM应用的，其实就是开关的打开和关断的时间比值，这个比值在宏观上可以欺骗人眼，于是形成和电位器一样的作用。比如对一个电灯来说，你在1秒内，打开开关0.5秒，再关闭0.5秒，如此反复，那么电灯就会闪烁，但是如果是1毫秒内，0.5毫秒打开，0.5毫秒关闭，由于视觉暂留作用，也可能由于灯光的亮灭速度赶不上开关速度（还没全亮就又没电了），于是人眼不感觉电灯在闪烁，而是感觉灯的亮度少了一半。同理，如果是0.1毫秒开，0.9毫秒灭，感觉灯的亮度就只有1/10了。对于电机的原理也差不多，开关开时电机加速，关闭时电机减速，根据是加速时间多还是减速时间多，我们感觉总体的转速就是快了或慢了。当然，具体分析时还需考虑电机的电感作用，电感有滤波效果，但是用这个方式去理解也是成立的。
	回到前面的频率问题，就如刚才说的，1秒内，0.5秒开，0.5秒灭，占空比是50%对吧？那么，1毫秒内，0.5毫秒开，0.5毫秒灭，占空比也是50%，对吧？如果是1秒呢，频率就是1HZ，如果是1毫秒，频率就是1KHZ，显然，同样是50%占空比，如果频率是1HZ，那电机肯定是跳着走的，灯光肯定闪得可以跳舞，不具有调速和调光的意义。

	PWM 主要用途是通过对一个的电源开关控制可以得到输出电压大小和占空比成正比的电源，虽
	然DAC 也可以输出与数字对应的电压，但这个电压驱动能力很弱，要想提供比较大的驱动能力实现
	起来很难，但PWM 很简单，只要用三极管等做为开关控制元件向后面的大负载提供电源。对电源的
	控制实际上也是对输出功率的控制，所以PWM 在马达转速、灯光亮暗这类控制上有着广泛的应用。





