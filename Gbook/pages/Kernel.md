
# 1 Kernel porting

# 2 Kernel programming 


inode 结构体

Unix系统一切皆文件，inode标识着这些文件，包含着所有文件的所有信息，

对文件系统操作的一些命令，本质是对inode的操作，如df ls stat find grep...命令

文件系统百分之一的空间分配给inode

文件类型：普通文件、目录、设备文件、链接文件、管道文件、套接字文件等
管理方式：目录树

inode是理解Linux文件系统和硬盘存储机制的基础

inode是在物理存储区（如硬盘、flash等）的、用于**记录文件所有信息**(除文件名)的存储区域，在系统中表现为一个结构体，文件与inode一一对应。

inode的数量再物理存储区格式化时就已经确定，每N个字节分配一个inode，每个inode占128byte
(如果N是1K，物理存储空间是1G，那么会分配1024个inode，占用空间为128M)

因为一个文件对应一个inode，所以系统可能出现 仍有剩余空间 但已无法创建新的文件的情况

使用df -i命令查看每个每个分区分配的inode数量和使用情况

每个inode都有一个唯一ID，使用ls -i可以查看

inode的存储区域与文件数据的存储区域是分开的，

对文件进行移动、重命名等操作不会影响到inode的ID
复制文件相当于创建，会增加inode

- 删除文件与inode

删除文件其实并不是删除文件数据，而是标记此inode可复用了，如果有新的文件需要覆盖这个空间，那么数据就会被清除

- 硬链接与软链接

1. 软链接
- 软件连接是一个文件，具有唯一inode ID，假设软链接文件是A，被链接文件是B，则A指向B
- 操作A会被指向B，删除A不影响B，删除B将不能访问A，除非A再指向其它(非软链接)文件 
- 可以有多个软链接文件指向链接文件

2. 硬链接 
- 硬链接也是一个文件，但其inode ID与被链接文件相同，假设硬链接文件是A，被链接文件是B
- 操作A相当于操作B，反之亦然, A和B永远保持着相同的内容，并且删除任何一个都不影响另一个
- 仍然可以有多个硬链接文件。硬链接相当于文件副本，只是文件名不同。

ext2 ext3 ext4等文件系统都支持inode，但分区和排布情况不同


从视图上看，文件系统将物理存储区划分为：引导块、超级块、inode表、文件数据块。
引导块  - 引导代码 boot区，如果没有操作系统，该块可能为空
超级块  - 存储文件系统的信息
inode表 - 存储文件    的信息， 操作文件时内核会将该表加载到内存 

要明确的概念是，文件系统与操作系统是独立的概念，文件系统可以脱离操作系统而存在，但操作系统必须依赖文件系统
。比如你可以将一个U盘或SD卡等格式化成某个文件系统，然后这个存储介质就以如上视图划分了，但显然没有任何操作系统

根文件系统 是指已经在上述视图中存在结构树的文件系统，比如Linux根文件系统，已经包含了/ /lib /bin等等，只是不同的版本包含的不一样.
显然，跟文件系统是已经布局好的文件系统，直接与操作系统运行环境相关。

- 内核、文件系统、根文件系统、操作系统之间的关系

内核是操作系统的基本核心，与文件系统、根文件系统无关，是独立的。

文件系统就是如上所述的，也是独立的，与内核、操作系统都没有关系，格式化为某种文件系统，其视图结构就已经确定。

根文件系统是在文件系统上的填充，文件系统只有结构框架，而根文件系统就是在其框架下的内容填充，填充了什么呢？这与操作系统相关，如果是Linux，一般填充/ /bin /etc /lib ...等等目录和文件，这些是操作系统必备的运行环境和工具，不同的根文件系统版本等区别也会导致内容的不同。

操作系统 在UNIX高级环境编程 中提到是 内核+shell&公共函数库 (+App) 的集合，实际就是 内核 + 根文件系统，这也是为什么在Linux移植的过程中，Uboot启动之后只需烧录Linux内核和根文件系统的原因。 shell和公共函数库都包含在了根文件系统当中。

